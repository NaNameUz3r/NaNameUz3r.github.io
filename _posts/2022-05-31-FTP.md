---
title: "FTP протокол"
tags: "Сеть"
lang: ru
show_edit_on_github: false
comment: true
license: false
modify_date: "2022-05-31"
show_subscribe: false
article_header:
  theme: dark
  type: overlay
  align: left
  background_image:
    src: /header_images/ftp.jpg
---

Если вы ищете быстрый и простой способ отправлять и получать файлы с друзьями, семьей или коллегами по работе, возможно вам следует знать о FTP.

<!--more--> 

# Что это такое

FTP — это аббревиатура от File Transfer Protocol. Этот сетевой протокол существует с 1980-х годов и до сих пор остается одним из наиболее часто используемых способов передачи файлов.

Название говорит само за себя — протокол служит для передачи файлов поверх TCP/IP, и в этой модели считается протоколом прикладного уровня.

В транзакциях FTP компьютер конечного пользователя принято называють "локальным хостом", а второй — удаленный компьютер является сервером. Разумеется, между ними должно быть сетевое соединение, и у каждого участника соответвущий софт (FTP сервер на сервере, и какой-то FTP клиент у пользователя).

Не смотря на то что передача файлов по сети может осуществляться с помощью HTTP протокола, с которым мы уже знакомились [тут](/2022/05/22/HTTP.html), к сожалению или к счастью FTP, как уже сказанно выше — до сих пор широко распространён. 

# Как это работает

FTP — это клиент-серверный протокол, который использует *два канала* связи: один, так называемый "командный канал", который служит для управления "общением" участников транзакции, и второй — для самой передачи данных.

FTP сервер может быть анонимным — это когда логиниться в него не надо, и работать с ним может фактически кто угодно. Своего рода помойка...) 
А может быть не анонимным и требовать авторизации.

Сеансы FTP работают в двух режимах: активном или пассивном.

В Активном режиме, после того как клиент инициализировал сеанск через запрос по командному каналу, сервер создает обратное соединение с клиентом и начинается передача данных.

В Пассивном режиме сервер использует командный канал для отправки клиенту информации, необходимой для открытия канала данных. Иными словами, в этом режиме клиент инициализирует передачу файлов, а не сервер. Такой режим хорошо работает, когда соединению "препядствуют" всякие фаерволлы, прокси и тд.

Пользователи могут работать с FTP сервером через интерфейсы командной строки из консоли, используя какие нибудь GUI приложения, или просто веб-браузер.

# Зачем он нужен, если есть HTTP

FTP — это старый добрый стандарт. Он очень прост и понятен в использовании. Мы можем передавать данные по HTTP, или пересылать их... по электронной почте X_X, но этим вариантам не хватает ясности, простоты и быстроты настройки, которые мы получаем используя FTP.

Этот протокол можно применять в простых и сложных сценариях, таких как доставка или получения необходимых данных на\с сервера, резервное копирование данных на другой сервер, репликация данных. Можно навелосипедить практически любой сценарий :D

# Типы FTP
Есть несколько видов имплементации протокола. Рассмотрим их вкратце.

**Anonymous FTP**

Самый простой вариант и небезопасный вариант. Сервер торчит в сеть и раздает данные в незашифрованном (как правило) формате и не требует никакой аутентификации и авторизации. Обычно это какая то слабо регулируемая общедоступное файловая помойка.

**Password-protected FTP**

То же самое что предыдущий вариант, только чуть безопаснее. Потребуется логин и пароль. Шифрования обычно тут тоже отсутствует.

**FTPS**

S — значит Secure. Данные шифрутся TLS.

**SFTP**

Технически, это не FTP протокол, но работает точно так же. SFTP это дитя SSH протокола, который обычно (сервер) работает на 22 порту. Наверное это самый безопасный вариант. Про SSH поговорим в другой раз. Вренемся к FTP.

# История и Безопасность

Давайте честно. Это старинная штука. Изначально FTP проткол определили в [RFC 114](https://datatracker.ietf.org/doc/html/rfc114), написанной Абхаё Бхушан (тогда ещё студент MIT) 16 апреля 71 года!! А это, на минуточку, раньше чем TCP и IP! Тогда ещё не было интернета, каким мы его знаем сейчас, а был ARPANET. Собственно в этой RFC и описывается идея предачи файлов в арпанете.

В последствии FTP разумеется переопределяли по мере эволюции интернета. 
Дружба с TCP/IP описана в [RFC 765](https://datatracker.ietf.org/doc/html/rfc765) в 1980 году Джоном Постелом (АйТи Университет Калифорнии), пять лет спустя в [RFC 959](https://www.ietf.org/rfc/rfc959.txt) добавили новые возможности управления протоколом, попытались обезопасить протокол только в 1997 году в [RFC 2228](https://datatracker.ietf.org/doc/html/rfc2228), и ещё через два года завезли поддержку IPv6 в  [RFC 2428](https://datatracker.ietf.org/doc/html/rfc2428).

По дефолту FTP вообще не шифруте трафик, и сниффить пакеты может кто угодно посередине. Это никуда не годится, собственно так и появились варианты FTPS и FTPES с поддержкой, соответственно, неявного и явного TLS соединения.

Но не смотря на все улучшения и попытки внедрить безопасность, протокол FPT всё ещё уязвим к брутфорс атакам на креды пользователей и к DOS.

# Недостатки FTP

На самом деле протокол использует два порта. 21 для командного канала и 20 для передачи данных. А ещё этот активный и пассивный режимы... Протокол сложно "резать" на сетевом экране. HTTP в этом моменте намного проще.

Понятие кодировки отсутствует. Если кодировки сервера и клиента отличаются, то скачав файл(ы) и имена и содержимое придется перекодировать. В HTTP такой проблемы нет, так как имеем метаданный в заголовках, где указан и тип файла, и кодировка передачи.

Отсутствие шифрования по умолчанию. Пусть оно и есть в модификациях, но как думаете, сколько на сервере администраторов которые ставят первый попавшийся под руку сервер и не заморачиваются по безопасности...?

# Резюме
Но не смотря на всё это... Оно ещё живое, и умирать похоже не планирует.
Лично я FTP не использую, а при необходимости реализовать передачу данных смотрел бы в сторону других решений. По моему "умолчанию", это это был бы на вскидку какой нибудь rsync по ssh или тупо scp. 

Но знать про FTP и уметь им пользоваться нужно! Только, пожалуйста, настраивайте хотя бы FTPS сервера...)

Миру мир! Будьте здоровы! 